import{d as c,a as $,r as a,t as q,u as E,F as l,E as i,H as n,G as u,B as F,O as v}from"./vlib.982cfaee.js";import{_ as y,j as H,c as k,g as V,b as m}from"./index.8146017f.js";/* empty css                   */import{Q as j}from"./quill.942ff23b.js";import"./monacoeditor.d62c48b5.js";import"./lodash.0b661716.js";import"./lib.b62e57c8.js";const w=c({setup(){return $({visible:!1,quillEditor:null,quillEditorToolbarOptions:[["bold","italic","underline","strike"],["blockquote","code-block","image"],[{header:1},{header:2}],[{list:"ordered"},{list:"bullet"}],[{script:"sub"},{script:"super"}],[{indent:"-1"},{indent:"+1"}],[{direction:"rtl"}],[{size:["small",!1,"large","huge"]}],[{header:[1,2,3,4,5,6,!1]}],[{color:[]},{background:[]}],[{font:[]}],[{align:[]}],["clean"]],uploadUrl:"",dataForm:{id:"",name:"",subject:"",content:""}})},computed:{dataRule(){const e=(t,f,r)=>{if(this.quillEditor&&this.quillEditor.getLength()<=1)return r(new Error(this.$t("validate.required")));r()};return{name:[{required:!0,message:this.$t("validate.required"),trigger:"blur"}],subject:[{required:!0,message:this.$t("validate.required"),trigger:"blur"}],content:[{required:!0,message:this.$t("validate.required"),trigger:"blur"},{validator:e,trigger:"blur"}]}}},created(){this.dataFormSubmitHandle=H(this.dataFormSubmitHandle)},methods:{init(){this.visible=!0,this.$nextTick(()=>{this.quillEditor?this.quillEditor.deleteText(0,this.quillEditor.getLength()):this.quillEditorHandle(),this.$refs.dataFormRef.resetFields(),this.dataForm.id&&this.getInfo()})},quillEditorHandle(){this.quillEditor=new j("#J_quillEditor",{modules:{toolbar:this.quillEditorToolbarOptions},theme:"snow"}),this.uploadUrl=`${k.api}/sys/oss/upload?token=${V()}`,this.quillEditor.getModule("toolbar").addHandler("image",()=>{this.$refs.uploadBtn.$el.click()}),this.quillEditor.on("text-change",()=>{this.quillEditor&&(this.dataForm.content=this.quillEditor.root.innerHTML)})},uploadBeforeUploadHandle(e){if(e.type!=="image/jpg"&&e.type!=="image/jpeg"&&e.type!=="image/png"&&e.type!=="image/gif")return this.$message.error(this.$t("upload.tip",{format:"jpg\u3001png\u3001gif"})),!1},uploadSuccessHandle(e){if(e.code!==0)return this.$message.error(e.msg);if(this.quillEditor){const t=this.quillEditor.getSelection();t&&this.quillEditor.insertEmbed(t.index,"image",e.data.src)}},getInfo(){m.get(`/sys/mailtemplate/${this.dataForm.id}`).then(e=>{if(e.code!==0)return this.$message.error(e.msg);this.quillEditor&&(this.dataForm=e.data,this.quillEditor.root.innerHTML=this.dataForm.content)})},dataFormSubmitHandle(){this.$refs.dataFormRef.validate(e=>{if(!e)return!1;(this.dataForm.id?m.put:m.post)("/sys/mailtemplate",this.dataForm,{"content-type":"application/x-www-form-urlencoded"}).then(t=>{if(t.code!==0)return this.$message.error(t.msg);this.$message({message:this.$t("prompt.success"),type:"success",duration:500,onClose:()=>{this.visible=!1,this.$emit("refreshDataList")}})})})}}});function S(e,t,f,r,U,B){const p=a("el-input"),s=a("el-form-item"),d=a("el-button"),h=a("el-upload"),g=a("el-form"),b=a("el-dialog");return q(),E(b,{modelValue:e.visible,"onUpdate:modelValue":t[5]||(t[5]=o=>e.visible=o),title:e.dataForm.id?e.$t("update"):e.$t("add"),"close-on-click-modal":!1,"close-on-press-escape":!1},{footer:l(()=>[i(d,{onClick:t[3]||(t[3]=o=>e.visible=!1)},{default:l(()=>[n(u(e.$t("cancel")),1)]),_:1}),i(d,{type:"primary",onClick:t[4]||(t[4]=o=>e.dataFormSubmitHandle())},{default:l(()=>[n(u(e.$t("confirm")),1)]),_:1})]),default:l(()=>[i(g,{model:e.dataForm,rules:e.dataRule,ref:"dataFormRef",onKeyup:t[2]||(t[2]=v(o=>e.dataFormSubmitHandle(),["enter"])),"label-width":"120px"},{default:l(()=>[i(s,{prop:"name",label:e.$t("mail.name")},{default:l(()=>[i(p,{modelValue:e.dataForm.name,"onUpdate:modelValue":t[0]||(t[0]=o=>e.dataForm.name=o),placeholder:e.$t("mail.name")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),i(s,{prop:"subject",label:e.$t("mail.subject")},{default:l(()=>[i(p,{modelValue:e.dataForm.subject,"onUpdate:modelValue":t[1]||(t[1]=o=>e.dataForm.subject=o),placeholder:e.$t("mail.subject")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),i(s,{prop:"content",label:e.$t("mail.content")},{default:l(()=>[t[6]||(t[6]=F("div",{id:"J_quillEditor",style:{height:"200px",width:"100%"}},null,-1)),i(h,{action:e.uploadUrl,"show-file-list":!1,"before-upload":e.uploadBeforeUploadHandle,"on-success":e.uploadSuccessHandle,style:{display:"none"}},{default:l(()=>[i(d,{ref:"uploadBtn",type:"primary",size:"small"},{default:l(()=>[n(u(e.$t("upload.button")),1)]),_:1},512)]),_:1},8,["action","before-upload","on-success"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}var N=y(w,[["render",S]]);export{N as default};
