import{u as N}from"./useView.385d0769.js";import{d as S,a as w,e as $,$ as H,r as l,t as s,u as i,F as a,E as n,H as d,G as m,a4 as U,f,B as h,A as c,I as D,L as P,J as B,O as R}from"./vlib.0bb5c6cc.js";import{_ as q,u as I,k as A,b as F}from"./index.d126106f.js";import"./monacoeditor.d62c48b5.js";import"./lodash.8cc0d8b0.js";import"./lib.aa75605a.js";const K=S({setup(){const e=w({visible:!1,menuList:[],iconList:[],menuListPopover:$(),iconListPopover:$(),dataForm:{id:"",menuType:0,name:"",pid:"0",parentName:"",url:"",permissions:"",sort:0,icon:"",openStyle:0}});return{...N(e),...H(e)}},computed:{dataRule(){return{name:[{required:!0,message:this.$t("validate.required"),trigger:"blur"}],parentName:[{required:!0,message:this.$t("validate.required"),trigger:"change"}]}}},watch:{"dataForm.menuType"(){this.$refs.dataFormRef.clearValidate()}},created(){this.dataFormSubmitHandle=I(this.dataFormSubmitHandle)},methods:{init(e){this.visible=!0,this.$nextTick(()=>{this.$refs.dataFormRef.resetFields(),this.iconList=A(),e?(this.dataForm.id="",this.dataForm.pid=e.id,this.dataForm.parentName=e.name):(this.dataForm.pid="0",this.dataForm.parentName=this.$t("menu.parentNameDefault")),this.getMenuList().then(()=>{this.dataForm.id&&this.getInfo()})})},getMenuList(){return F.get("/sys/menu/list?type=0").then(e=>{if(e.code!==0)return this.$message.error(e.msg);this.menuList=e.data})},getInfo(){F.get(`/sys/menu/${this.dataForm.id}`).then(e=>{if(e.code!==0)return this.$message.error(e.msg);if(this.dataForm={...this.dataForm,...e.data},this.dataForm.pid==="0")return this.deptListTreeSetDefaultHandle();this.$refs.menuListTree.setCurrentKey(this.dataForm.pid)})},deptListTreeSetDefaultHandle(){this.dataForm.pid="0",this.dataForm.parentName=this.$t("menu.parentNameDefault")},menuListTreeCurrentChangeHandle(e){this.dataForm.pid=e.id,this.dataForm.parentName=e.name,this.menuListPopover.hide()},iconListCurrentChangeHandle(e){this.dataForm.icon=e,this.iconListPopover.hide()},dataFormSubmitHandle(){this.$refs.dataFormRef.validate(e=>{if(!e)return!1;(this.dataForm.id?F.put:F.post)("/sys/menu",this.dataForm).then(t=>{if(t.code!==0)return this.$message.error(t.msg);this.$message({message:this.$t("prompt.success"),type:"success",duration:500,onClose:()=>{this.visible=!1,this.$emit("refreshDataList")}})})})}}}),M={class:"popover-pop-body"},O={class:"mod-sys__menu-icon-inner"},z={class:"mod-sys__menu-icon-list"},E={class:"icon-svg","aria-hidden":"true"},G=["xlink:href"];function J(e,t,j,Q,W,X){const p=l("el-radio"),g=l("el-radio-group"),r=l("el-form-item"),u=l("el-input"),v=l("circle-close"),_=l("el-icon"),V=l("el-tree"),b=l("el-popover"),L=l("el-input-number"),y=l("el-button"),C=l("el-form"),k=l("el-dialog");return s(),i(k,{modelValue:e.visible,"onUpdate:modelValue":t[12]||(t[12]=o=>e.visible=o),title:e.dataForm.id?e.$t("update"):e.$t("add"),"close-on-click-modal":!1,"close-on-press-escape":!1},{footer:a(()=>[n(y,{onClick:t[10]||(t[10]=o=>e.visible=!1)},{default:a(()=>[d(m(e.$t("cancel")),1)]),_:1}),n(y,{type:"primary",onClick:t[11]||(t[11]=o=>e.dataFormSubmitHandle())},{default:a(()=>[d(m(e.$t("confirm")),1)]),_:1})]),default:a(()=>[n(C,{model:e.dataForm,rules:e.dataRule,ref:"dataFormRef",onKeyup:t[9]||(t[9]=R(o=>e.dataFormSubmitHandle(),["enter"])),"label-width":"120px"},{default:a(()=>[n(r,{prop:"menuType",label:e.$t("menu.type")},{default:a(()=>[n(g,{modelValue:e.dataForm.menuType,"onUpdate:modelValue":t[0]||(t[0]=o=>e.dataForm.menuType=o),disabled:!!e.dataForm.id},{default:a(()=>[n(p,{label:0},{default:a(()=>[d(m(e.$t("menu.type0")),1)]),_:1}),n(p,{label:1},{default:a(()=>[d(m(e.$t("menu.type1")),1)]),_:1})]),_:1},8,["modelValue","disabled"])]),_:1},8,["label"]),n(r,{prop:"name",label:e.$t("menu.name")},{default:a(()=>[n(u,{modelValue:e.dataForm.name,"onUpdate:modelValue":t[1]||(t[1]=o=>e.dataForm.name=o),placeholder:e.$t("menu.name")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),n(r,{prop:"parentName",label:e.$t("menu.parentName"),class:"menu-list"},{default:a(()=>[n(b,{ref:"menuListPopover",placement:"bottom-start",trigger:"click",width:400,"popper-class":"popover-pop"},{reference:a(()=>[n(u,{modelValue:e.dataForm.parentName,"onUpdate:modelValue":t[3]||(t[3]=o=>e.dataForm.parentName=o),readonly:!0,placeholder:e.$t("menu.parentName")},{suffix:a(()=>[e.dataForm.pid!=="0"?(s(),i(_,{key:0,onClick:t[2]||(t[2]=U(o=>e.deptListTreeSetDefaultHandle(),["stop"])),class:"el-input__icon"},{default:a(()=>[n(v)]),_:1})):f("",!0)]),_:1},8,["modelValue","placeholder"])]),default:a(()=>[h("div",M,[n(V,{data:e.menuList,props:{label:"name",children:"children"},"node-key":"id",ref:"menuListTree","highlight-current":!0,"expand-on-click-node":!1,accordion:"",onCurrentChange:e.menuListTreeCurrentChangeHandle},null,8,["data","onCurrentChange"])])]),_:1},512)]),_:1},8,["label"]),e.dataForm.menuType===0?(s(),i(r,{key:0,prop:"url",label:e.$t("menu.url")},{default:a(()=>[n(u,{modelValue:e.dataForm.url,"onUpdate:modelValue":t[4]||(t[4]=o=>e.dataForm.url=o),placeholder:e.$t("menu.url")},null,8,["modelValue","placeholder"])]),_:1},8,["label"])):f("",!0),n(r,{prop:"sort",label:e.$t("menu.sort")},{default:a(()=>[n(L,{modelValue:e.dataForm.sort,"onUpdate:modelValue":t[5]||(t[5]=o=>e.dataForm.sort=o),"controls-position":"right",min:0,label:e.$t("menu.sort")},null,8,["modelValue","label"])]),_:1},8,["label"]),e.dataForm.menuType===0?(s(),i(r,{key:1,prop:"openStyle",label:e.$t("menu.openStyle")},{default:a(()=>[n(g,{modelValue:e.dataForm.openStyle,"onUpdate:modelValue":t[6]||(t[6]=o=>e.dataForm.openStyle=o)},{default:a(()=>[n(p,{label:0},{default:a(()=>[d(m(e.$t("menu.openStyle0")),1)]),_:1}),n(p,{label:1},{default:a(()=>[d(m(e.$t("menu.openStyle1")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"])):f("",!0),n(r,{prop:"permissions",label:e.$t("menu.permissions")},{default:a(()=>[n(u,{modelValue:e.dataForm.permissions,"onUpdate:modelValue":t[7]||(t[7]=o=>e.dataForm.permissions=o),placeholder:e.$t("menu.permissionsTips")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),e.dataForm.menuType===0?(s(),i(r,{key:2,prop:"icon",label:e.$t("menu.icon"),class:"icon-list"},{default:a(()=>[n(b,{ref:"iconListPopover",placement:"top-start",trigger:"click","popper-class":"popover-pop mod-sys__menu-icon-popover"},{reference:a(()=>[n(u,{modelValue:e.dataForm.icon,"onUpdate:modelValue":t[8]||(t[8]=o=>e.dataForm.icon=o),readonly:!0,placeholder:e.$t("menu.icon")},null,8,["modelValue","placeholder"])]),default:a(()=>[h("div",O,[h("div",z,[(s(!0),c(B,null,D(e.iconList,(o,T)=>(s(),i(y,{key:T,onClick:Y=>e.iconListCurrentChangeHandle(o),class:P({"is-active":e.dataForm.icon===o})},{default:a(()=>[(s(),c("svg",E,[h("use",{"xlink:href":`#${o}`},null,8,G)]))]),_:2},1032,["onClick","class"]))),128))])])]),_:1},512)]),_:1},8,["label"])):f("",!0)]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}var ne=q(K,[["render",J]]);export{ne as default};
