import{d as _,R as y,a as C,e as L,$ as V,r as s,t as p,u as m,F as a,E as r,H as u,G as f,a4 as N,f as H,B as S,O as k}from"./vlib.0bb5c6cc.js";import{_ as T,u as D,b as d}from"./index.3a8d87d2.js";import"./monacoeditor.d62c48b5.js";import"./lodash.8cc0d8b0.js";import"./lib.aa75605a.js";const R=_({setup(){const e=y(),t=C({visible:!1,deptList:[],deptListPopover:L(),dataForm:{id:"",name:"",pid:"",parentName:"",sort:0}});return{user:e.state.user,...V(t)}},computed:{dataRule(){return{name:[{required:!0,message:this.$t("validate.required"),trigger:"blur"}],parentName:[{required:!0,message:this.$t("validate.required"),trigger:"change"}]}}},created(){this.dataFormSubmitHandle=D(this.dataFormSubmitHandle)},methods:{init(){this.visible=!0,this.$nextTick(()=>{this.$refs.dataFormRef.resetFields(),this.getDeptList().then(()=>{this.dataForm.id?this.getInfo():(this.$store.state.user.superAdmin===1||this.$store.state.user.superTenant===1)&&this.deptListTreeSetDefaultHandle()})})},getDeptList(){return d.get("/sys/dept/list").then(e=>{if(e.code!==0)return this.$message.error(e.msg);this.deptList=e.data})},getInfo(){d.get(`/sys/dept/${this.dataForm.id}`).then(e=>{if(e.code!==0)return this.$message.error(e.msg);if(this.dataForm={...this.dataForm,...e.data},this.dataForm.pid==="0")return this.deptListTreeSetDefaultHandle();this.$refs.deptListTree.setCurrentKey(this.dataForm.pid)})},deptListTreeSetDefaultHandle(){this.dataForm.pid="0",this.dataForm.parentName=this.$t("dept.parentNameDefault")},deptListTreeCurrentChangeHandle(e){this.dataForm.pid=e.id,this.dataForm.parentName=e.name,this.deptListPopover.hide()},dataFormSubmitHandle(){this.$refs.dataFormRef.validate(e=>{if(!e)return!1;(this.dataForm.id?d.put:d.post)("/sys/dept",this.dataForm).then(t=>{if(t.code!==0)return this.$message.error(t.msg);this.$message({message:this.$t("prompt.success"),type:"success",duration:500,onClose:()=>{this.visible=!1,this.$emit("refreshDataList")}})})})}}}),U={class:"popover-pop-body"};function w(e,t,q,A,B,K){const l=s("el-input"),i=s("el-form-item"),h=s("circle-close"),$=s("el-icon"),g=s("el-tree"),c=s("el-popover"),F=s("el-input-number"),b=s("el-form"),n=s("el-button"),v=s("el-dialog");return p(),m(v,{modelValue:e.visible,"onUpdate:modelValue":t[7]||(t[7]=o=>e.visible=o),title:e.dataForm.id?e.$t("update"):e.$t("add"),"close-on-click-modal":!1,"close-on-press-escape":!1},{footer:a(()=>[r(n,{onClick:t[5]||(t[5]=o=>e.visible=!1)},{default:a(()=>[u(f(e.$t("cancel")),1)]),_:1}),r(n,{type:"primary",onClick:t[6]||(t[6]=o=>e.dataFormSubmitHandle())},{default:a(()=>[u(f(e.$t("confirm")),1)]),_:1})]),default:a(()=>[r(b,{model:e.dataForm,rules:e.dataRule,ref:"dataFormRef",onKeyup:t[4]||(t[4]=k(o=>e.dataFormSubmitHandle(),["enter"])),"label-width":"120px"},{default:a(()=>[r(i,{prop:"name",label:e.$t("dept.name")},{default:a(()=>[r(l,{modelValue:e.dataForm.name,"onUpdate:modelValue":t[0]||(t[0]=o=>e.dataForm.name=o),placeholder:e.$t("dept.name")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),r(i,{prop:"parentName",label:e.$t("dept.parentName"),class:"dept-list"},{default:a(()=>[r(c,{width:400,ref:"deptListPopover",placement:"bottom-start",trigger:"click","popper-class":"popover-pop"},{reference:a(()=>[r(l,{modelValue:e.dataForm.parentName,"onUpdate:modelValue":t[2]||(t[2]=o=>e.dataForm.parentName=o),readonly:!0,placeholder:e.$t("dept.parentName")},{suffix:a(()=>[e.user.superAdmin===1&&e.dataForm.pid!=="0"?(p(),m($,{key:0,onClick:t[1]||(t[1]=N(o=>e.deptListTreeSetDefaultHandle(),["stop"])),class:"el-input__icon"},{default:a(()=>[r(h)]),_:1})):H("",!0)]),_:1},8,["modelValue","placeholder"])]),default:a(()=>[S("div",U,[r(g,{data:e.deptList,props:{label:"name",children:"children"},"node-key":"id",ref:"deptListTree","highlight-current":!0,"expand-on-click-node":!1,accordion:"",onCurrentChange:e.deptListTreeCurrentChangeHandle},null,8,["data","onCurrentChange"])])]),_:1},512)]),_:1},8,["label"]),r(i,{prop:"sort",label:e.$t("dept.sort")},{default:a(()=>[r(F,{modelValue:e.dataForm.sort,"onUpdate:modelValue":t[3]||(t[3]=o=>e.dataForm.sort=o),"controls-position":"right",min:0,label:e.$t("dept.sort")},null,8,["modelValue","label"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}var M=T(R,[["render",w]]);export{M as default};
