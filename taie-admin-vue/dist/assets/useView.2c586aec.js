import{c as I,b as l,d as n,a as b,q as T,g as D,e as $,E as U,f as c,h as p,r as u,i as O,j as P}from"./index.6b1e63f3.js";import{D as S,R as w,o as F,l as R,n as g}from"./vlib.0bb5c6cc.js";const N=m=>{const{t:i}=I(),f=S(),o=w(),e=((t,a)=>{for(const s in t)Object.getOwnPropertyDescriptor(a,s)||(a[s]=t[s]);return a})({createdIsNeed:!0,activatedIsNeed:!1,getDataListURL:"",getDataListIsPage:!1,deleteURL:"",deleteIsBatch:!1,deleteIsBatchKey:"id",exportURL:"",dataForm:{},dataList:[],order:"",orderField:"",page:1,limit:10,total:0,dataListLoading:!1,dataListSelections:[],addOrUpdateVisible:!1,addOrUpdate:{},elTable:{}},m);F(()=>{e.createdIsNeed&&!e.activatedIsNeed&&r.query()}),R(()=>{if(o.state.closedTabs.includes(o.state.activeTabName)){const t=o.state.closedTabs;o.dispatch({type:"updateState",payload:{closedTabs:t.filter(a=>a!==o.state.activeTabName)}}),c.emit(p.OnReloadTabPage)}e.activatedIsNeed&&r.query()});const L=()=>{const t=e.addOrUpdate;if(t&&t.$parent&&t.$parent.$el){const a=t.$parent.$el;a.setAttribute("tabindex",0),a.focus(),a.blur(),a.removeAttribute("tabindex")}},h={hasPermission(t){return O(o.state.permissions,t)},getDictLabel(t,a){return P(o.state.dicts,t,a)}},r={query(){if(!e.getDataListURL)return;e.dataListLoading=!0;let t;e.post?t=l.post(e.getDataListURL,{order:e.order,orderField:e.orderField,page:e.getDataListIsPage?e.page:null,limit:e.getDataListIsPage?e.limit:null,...e.dataForm}):t=l.get(e.getDataListURL,{order:e.order,orderField:e.orderField,page:e.getDataListIsPage?e.page:null,limit:e.getDataListIsPage?e.limit:null,...e.dataForm}),t.then(a=>{if(e.dataListLoading=!1,a.code!==0)return e.dataList=[],e.total=0,n.error(a.msg);e.dataList=e.getDataListIsPage?a.data.list:a.data,e.total=e.getDataListIsPage?a.data.total:0}).catch(()=>{e.dataListLoading=!1})},dataListSelectionChangeHandle(t){e.dataListSelections=t},dataListSortChangeHandle(t){if(!t.order||!t.prop)return e.order="",e.orderField="",!1;e.order=t.order.replace(/ending$/,""),e.orderField=t.prop.replace(/([A-Z])/g,"_$1").toLowerCase(),r.query()},pageSizeChangeHandle(t){e.page=1,e.limit=t,r.query()},pageCurrentChangeHandle(t){e.page=t,r.query()},getDataList(){e.page=1,r.query()},addHandle(t){e.addOrUpdateVisible=!0,g(()=>{var a;(a=e.addOrUpdate)==null||a.init(t)})},addOrUpdateHandle(t){e.addOrUpdateVisible=!0,g(()=>{e.addOrUpdate&&!e.addOrUpdate.visible&&(L(),e.addOrUpdate.dataForm.id=t||"",e.addOrUpdate.init())})},deleteHandle(t,a){return new Promise((s,y)=>{if(e.deleteIsBatch&&!t&&e.dataListSelections&&e.dataListSelections.length<=0){n.message({message:i("prompt.deleteBatch"),type:"warning",duration:500});return}n.confirm(i("prompt.info",{handle:i("delete")}),i("prompt.title"),{confirmButtonText:i("confirm"),cancelButtonText:i("cancel"),type:"warning"}).then(()=>{l.delete(`${e.deleteURL}${e.deleteIsBatch?"":"/"+t}`,e.deleteIsBatch?t?[t]:e.dataListSelections?e.dataListSelections.map(d=>e.deleteIsBatchKey&&d[e.deleteIsBatchKey]):{}:{}).then(d=>{if(d.code!==0)return n.error(d.msg),y(new Error(d.msg));n.message({message:i("prompt.success"),type:"success",duration:500,onClose:()=>{a&&e.elTable?(e.elTable.store.states.lazyTreeNodeMap.pid=[],s(!0)):(r.query(),s(!0))}})})}).catch(()=>{})})},exportHandle(){window.location.href=`${b.api}${e.exportURL}?${T.stringify({...e.dataForm,token:D()})}`},closeCurrentTab(){$(U.OpenTabsPage)?c.emit(p.OnCloseCurrTab):f.replace("/home")},handleFlowRoute(t){const a=this,s={path:`/flow-form/${t.processDefinitionKey}/form`,query:{taskId:t.taskId,processInstanceId:t.processInstanceId,businessKey:t.businessKey,showType:"taskHandle",_mt:`${a.$route.meta.title} - ${t.processDefinitionName}`}};u(s)},flowDetailRoute(t){const a=this,s={path:`/flow-form/${t.processDefinitionKey}/form`,query:{taskId:t.taskId,processInstanceId:t.processInstanceId,businessKey:t.businessKey,showType:"detail",_mt:`${a.$route.meta.title} - ${t.processDefinitionName}`}};u(s)}};return{...r,...h}};export{N as u};
