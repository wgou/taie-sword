import{d as q,a as T,r as a,t as E,u as k,G as r,F as i,I as l,H as s,f as c,B as C,z as L,a5 as V}from"./vlib.73c86f1d.js";/* empty css                   */import{Q as H}from"./quill.942ff23b.js";import{_ as w,j as B,c as S,g as U,b as p}from"./index.bc4fd47c.js";import"./monacoeditor.d62c48b5.js";import"./lodash.58534d7e.js";import"./lib.e5e0e84e.js";const _=q({setup(){return T({visible:!1,quillEditor:null,quillEditorToolbarOptions:[["bold","italic","underline","strike"],["image"],[{list:"ordered"},{list:"bullet"}],[{size:["small",!1,"large","huge"]}],[{color:[]},{background:[]}],["clean"]],uploadUrl:"",deptList:[],dataForm:{id:0,noticeType:0,title:"",content:"",receiverType:0,receiverTypeIds:"",receiverTypeList:[],status:0,senderName:"",senderDate:"",creator:0,createDate:""}})},computed:{dataRule(){const e=(t,n,m)=>{if(this.quillEditor&&this.quillEditor.getLength()<=1)return m(new Error(this.$t("validate.required")));m()};return{noticeType:[{required:!0,message:this.$t("validate.required"),trigger:"blur"}],title:[{required:!0,message:this.$t("validate.required"),trigger:"blur"}],content:[{required:!0,message:this.$t("validate.required"),trigger:"blur"},{validator:e,trigger:"blur"}],receiverType:[{required:!0,message:this.$t("validate.required"),trigger:"blur"}],receiverTypeIds:[{required:!0,message:this.$t("validate.required"),trigger:"blur"}],status:[{required:!0,message:this.$t("validate.required"),trigger:"blur"}],senderName:[{required:!0,message:this.$t("validate.required"),trigger:"blur"}]}}},created(){this.dataFormSubmitHandle=B(this.dataFormSubmitHandle)},methods:{init(){this.visible=!0,this.$nextTick(()=>{this.quillEditor?this.quillEditor.deleteText(0,this.quillEditor.getLength()):this.quillEditorHandle(),this.$refs.dataFormRef.resetFields(),Promise.all([this.getDeptList()]).then(()=>{this.dataForm.id&&this.getInfo()})})},quillEditorHandle(){this.quillEditor=new H("#J_quillEditor",{modules:{toolbar:this.quillEditorToolbarOptions},theme:"snow"}),this.uploadUrl=`${S.api}/sys/oss/upload?token=${U()}`,this.quillEditor.getModule("toolbar").addHandler("image",()=>{this.$refs.uploadBtn.$el.click()}),this.quillEditor.on("text-change",()=>{this.quillEditor&&(this.dataForm.content=this.quillEditor.root.innerHTML)})},uploadBeforeUploadHandle(e){if(e.type!=="image/jpg"&&e.type!=="image/jpeg"&&e.type!=="image/png"&&e.type!=="image/gif")return this.$message.error(this.$t("upload.tip",{format:"jpg\u3001png\u3001gif"})),!1},uploadSuccessHandle(e){if(e.code!==0)return this.$message.error(e.msg);if(this.quillEditor){const t=this.quillEditor.getSelection();t&&this.quillEditor.insertEmbed(t.index,"image",e.data.src)}},getDeptList(){return p.get("/sys/dept/list").then(e=>{if(e.code!==0)return this.$message.error(e.msg);this.deptList=e.data})},getInfo(){p.get(`/sys/notice/${this.dataForm.id}`).then(e=>{if(e.code!==0)return this.$message.error(e.msg);this.dataForm={...this.dataForm,...e.data},this.quillEditor&&(this.quillEditor.root.innerHTML=this.dataForm.content),this.dataForm.receiverType===1&&this.$refs.deptListTree.setCheckedKeys(e.data.receiverTypeIds.split(","))})},dataFormSubmitHandle(e){this.$refs.dataFormRef.validate(t=>{if(!t)return!1;this.dataForm.receiverType===1?(this.dataForm.receiverTypeIds=this.$refs.deptListTree.getCheckedKeys().join(","),this.dataForm.receiverTypeList=this.$refs.deptListTree.getCheckedKeys()):this.dataForm.receiverTypeIds="",this.dataForm.status=e,(this.dataForm.id?p.put:p.post)("/sys/notice/",this.dataForm).then(n=>{if(n.code!==0)return this.$message.error(n.msg);this.$message({message:this.$t("prompt.success"),type:"success",duration:500,onClose:()=>{this.visible=!1,this.$emit("refreshDataList")}})})})}}});function D(e,t,n,m,I,j){const g=a("ren-radio-group"),d=a("el-form-item"),f=a("el-input"),u=a("el-button"),b=a("el-upload"),h=a("el-radio"),$=a("el-radio-group"),v=a("el-tree"),y=a("el-form"),F=a("el-dialog");return E(),k(F,{modelValue:e.visible,"onUpdate:modelValue":t[6]||(t[6]=o=>e.visible=o),title:e.dataForm.id?e.$t("update"):e.$t("add"),"close-on-click-modal":!1,"close-on-press-escape":!1},{footer:r(()=>[i(u,{onClick:t[3]||(t[3]=o=>e.visible=!1)},{default:r(()=>[l(s(e.$t("cancel")),1)]),_:1}),i(u,{type:"danger",onClick:t[4]||(t[4]=o=>e.dataFormSubmitHandle(0))},{default:r(()=>[l(s(e.$t("notice.draft")),1)]),_:1}),i(u,{type:"primary",onClick:t[5]||(t[5]=o=>e.dataFormSubmitHandle(1))},{default:r(()=>[l(s(e.$t("notice.release")),1)]),_:1})]),default:r(()=>[i(y,{model:e.dataForm,rules:e.dataRule,ref:"dataFormRef","label-width":e.$i18n.locale==="en-US"?"120px":"80px"},{default:r(()=>[i(d,{label:e.$t("notice.type"),prop:"noticeType"},{default:r(()=>[i(g,{modelValue:e.dataForm.noticeType,"onUpdate:modelValue":t[0]||(t[0]=o=>e.dataForm.noticeType=o),"dict-type":"notice_type"},null,8,["modelValue"])]),_:1},8,["label"]),i(d,{label:e.$t("notice.title"),prop:"title"},{default:r(()=>[i(f,{modelValue:e.dataForm.title,"onUpdate:modelValue":t[1]||(t[1]=o=>e.dataForm.title=o),placeholder:e.$t("notice.title")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),i(d,{prop:"content",label:e.$t("notice.content")},{default:r(()=>[c(" \u5BCC\u6587\u672C\u7F16\u8F91\u5668, \u5BB9\u5668 "),t[7]||(t[7]=C("div",{id:"J_quillEditor",style:{height:"280px",width:"100%"}},null,-1)),c(" \u81EA\u5B9A\u4E49\u4E0A\u4F20\u56FE\u7247\u529F\u80FD (\u4F7F\u7528element upload\u7EC4\u4EF6) "),i(b,{action:e.uploadUrl,"show-file-list":!1,"before-upload":e.uploadBeforeUploadHandle,"on-success":e.uploadSuccessHandle,style:{display:"none"}},{default:r(()=>[i(u,{ref:"uploadBtn",type:"primary",size:"small"},{default:r(()=>[l(s(e.$t("upload.button")),1)]),_:1},512)]),_:1},8,["action","before-upload","on-success"])]),_:1},8,["label"]),i(d,{label:e.$t("notice.receiverType"),prop:""},{default:r(()=>[i($,{modelValue:e.dataForm.receiverType,"onUpdate:modelValue":t[2]||(t[2]=o=>e.dataForm.receiverType=o)},{default:r(()=>[i(h,{label:0},{default:r(()=>[l(s(e.$t("notice.receiverType0")),1)]),_:1}),i(h,{label:1},{default:r(()=>[l(s(e.$t("notice.receiverType1")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),L(i(d,{label:e.$t("notice.selectDept")},{default:r(()=>[i(v,{data:e.deptList,props:{label:"name",children:"children"},"node-key":"id",ref:"deptListTree",accordion:"","show-checkbox":""},null,8,["data"])]),_:1},8,["label"]),[[V,e.dataForm.receiverType==1]])]),_:1},8,["model","rules","label-width"])]),_:1},8,["modelValue","title"])}var J=w(_,[["render",D],["__file","/Users/luochen/project17/taie-sword/taie-admin-vue/src/views/notice/notice-add-or-update.vue"]]);export{J as default};
