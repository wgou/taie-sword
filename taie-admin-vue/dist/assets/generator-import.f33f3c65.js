import{_ as I,u as $,b as u}from"./index.3a8d87d2.js";import{d as C,a as D,r as s,t as r,u as n,F as o,E as l,H as p,A as F,I as c,J as h}from"./vlib.0bb5c6cc.js";import"./lodash.8cc0d8b0.js";import"./monacoeditor.d62c48b5.js";import"./lib.aa75605a.js";const S=C({setup(){return D({visible:!1,dataForm:{id:"",datasourceId:"",datasourceList:[],tableInfoList:[],tableInfo:{tableName:""},showTableSelect:!1}})},computed:{dataRule(){return{datasourceId:[{required:!0,message:"\u5FC5\u586B\u9879\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],tableInfo:[{validator:(a,v,d)=>{if(!this.dataForm.tableInfo.tableName)return d(new Error("\u5FC5\u586B\u9879\u4E0D\u80FD\u4E3A\u7A7A"));d()},trigger:"blur"}]}}},created(){this.dataFormSubmitHandle=$(this.dataFormSubmitHandle)},methods:{init(){this.visible=!0,this.$nextTick(()=>{this.$refs.dataFormRef.resetFields(),this.getDataSource()})},getDataSource(){u.get("/devtools/datasource/list").then(e=>{if(e.code!==0)return this.$message.error(e.msg);this.dataForm.datasourceList=e.data})},getTableInfoList(){this.dataForm.showTableSelect=!1,this.dataForm.tableInfo.tableName="",u.get("/devtools/datasource/table/list/"+this.dataForm.datasourceId).then(e=>{if(e.code!==0)return this.$message.error(e.msg);this.dataForm.tableInfoList=e.data,this.dataForm.showTableSelect=!0})},dataFormSubmitHandle(){this.$refs.dataFormRef.validate(e=>{if(!e)return!1;(this.dataForm.id?u.put:u.post)("/devtools/datasource/table",this.dataForm.tableInfo).then(a=>{if(a.code!==0)return this.$message.error(a.msg);this.$message({message:this.$t("prompt.success"),type:"success",duration:500,onClose:()=>{this.visible=!1,this.$emit("refreshDataList")}})})})}}});function V(e,a,v,d,k,B){const i=s("el-option"),m=s("el-select"),f=s("el-form-item"),g=s("el-form"),b=s("el-button"),E=s("el-dialog");return r(),n(E,{modelValue:e.visible,"onUpdate:modelValue":a[3]||(a[3]=t=>e.visible=t),title:"\u5BFC\u5165\u6570\u636E\u5E93\u8868","close-on-click-modal":!1,"close-on-press-escape":!1},{footer:o(()=>[l(b,{onClick:a[2]||(a[2]=t=>e.visible=!1)},{default:o(()=>a[4]||(a[4]=[p("\u53D6\u6D88")])),_:1}),l(b,{type:"primary",onClick:e.dataFormSubmitHandle},{default:o(()=>a[5]||(a[5]=[p("\u786E\u5B9A")])),_:1},8,["onClick"])]),default:o(()=>[l(g,{model:e.dataForm,rules:e.dataRule,ref:"dataFormRef","label-width":"120px"},{default:o(()=>[l(f,{label:"\u6570\u636E\u6E90",prop:"datasourceId"},{default:o(()=>[l(m,{modelValue:e.dataForm.datasourceId,"onUpdate:modelValue":a[0]||(a[0]=t=>e.dataForm.datasourceId=t),onChange:e.getTableInfoList,style:{width:"100%"},placeholder:"\u8BF7\u9009\u62E9\u6570\u636E\u6E90"},{default:o(()=>[l(i,{label:"\u9ED8\u8BA4\u6570\u636E\u6E90",value:"0"}),(r(!0),F(h,null,c(e.dataForm.datasourceList,t=>(r(),n(i,{key:t.id,label:t.connName,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"])]),_:1}),l(f,{label:"\u9009\u62E9\u8868",prop:"tableInfo"},{default:o(()=>[l(m,{modelValue:e.dataForm.tableInfo,"onUpdate:modelValue":a[1]||(a[1]=t=>e.dataForm.tableInfo=t),"value-key":"tableName",disabled:!e.dataForm.showTableSelect,style:{width:"100%"},placeholder:"\u8BF7\u9009\u62E9\u8868\u540D"},{default:o(()=>[(r(!0),F(h,null,c(e.dataForm.tableInfoList,t=>(r(),n(i,{key:t.tableName,label:t.tableName,value:t},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])}var N=I(S,[["render",V]]);export{N as default};
