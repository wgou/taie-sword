import{d as _,U as y,a as C,e as L,a0 as V,r as o,t as p,u as m,G as a,F as r,I as u,H as f,a6 as N,f as H,B as S,P as k}from"./vlib.73c86f1d.js";import{_ as T,j as D,b as d}from"./index.bc4fd47c.js";import"./monacoeditor.d62c48b5.js";import"./lodash.58534d7e.js";import"./lib.e5e0e84e.js";const U=_({setup(){const e=y(),t=C({visible:!1,deptList:[],deptListPopover:L(),dataForm:{id:"",name:"",pid:"",parentName:"",sort:0}});return{user:e.state.user,...V(t)}},computed:{dataRule(){return{name:[{required:!0,message:this.$t("validate.required"),trigger:"blur"}],parentName:[{required:!0,message:this.$t("validate.required"),trigger:"change"}]}}},created(){this.dataFormSubmitHandle=D(this.dataFormSubmitHandle)},methods:{init(){this.visible=!0,this.$nextTick(()=>{this.$refs.dataFormRef.resetFields(),this.getDeptList().then(()=>{this.dataForm.id?this.getInfo():(this.$store.state.user.superAdmin===1||this.$store.state.user.superTenant===1)&&this.deptListTreeSetDefaultHandle()})})},getDeptList(){return d.get("/sys/dept/list").then(e=>{if(e.code!==0)return this.$message.error(e.msg);this.deptList=e.data})},getInfo(){d.get(`/sys/dept/${this.dataForm.id}`).then(e=>{if(e.code!==0)return this.$message.error(e.msg);if(this.dataForm={...this.dataForm,...e.data},this.dataForm.pid==="0")return this.deptListTreeSetDefaultHandle();this.$refs.deptListTree.setCurrentKey(this.dataForm.pid)})},deptListTreeSetDefaultHandle(){this.dataForm.pid="0",this.dataForm.parentName=this.$t("dept.parentNameDefault")},deptListTreeCurrentChangeHandle(e){this.dataForm.pid=e.id,this.dataForm.parentName=e.name,this.deptListPopover.hide()},dataFormSubmitHandle(){this.$refs.dataFormRef.validate(e=>{if(!e)return!1;(this.dataForm.id?d.put:d.post)("/sys/dept",this.dataForm).then(t=>{if(t.code!==0)return this.$message.error(t.msg);this.$message({message:this.$t("prompt.success"),type:"success",duration:500,onClose:()=>{this.visible=!1,this.$emit("refreshDataList")}})})})}}}),w={class:"popover-pop-body"};function R(e,t,q,A,B,P){const l=o("el-input"),i=o("el-form-item"),h=o("circle-close"),c=o("el-icon"),g=o("el-tree"),$=o("el-popover"),v=o("el-input-number"),F=o("el-form"),n=o("el-button"),b=o("el-dialog");return p(),m(b,{modelValue:e.visible,"onUpdate:modelValue":t[7]||(t[7]=s=>e.visible=s),title:e.dataForm.id?e.$t("update"):e.$t("add"),"close-on-click-modal":!1,"close-on-press-escape":!1},{footer:a(()=>[r(n,{onClick:t[5]||(t[5]=s=>e.visible=!1)},{default:a(()=>[u(f(e.$t("cancel")),1)]),_:1}),r(n,{type:"primary",onClick:t[6]||(t[6]=s=>e.dataFormSubmitHandle())},{default:a(()=>[u(f(e.$t("confirm")),1)]),_:1})]),default:a(()=>[r(F,{model:e.dataForm,rules:e.dataRule,ref:"dataFormRef",onKeyup:t[4]||(t[4]=k(s=>e.dataFormSubmitHandle(),["enter"])),"label-width":"120px"},{default:a(()=>[r(i,{prop:"name",label:e.$t("dept.name")},{default:a(()=>[r(l,{modelValue:e.dataForm.name,"onUpdate:modelValue":t[0]||(t[0]=s=>e.dataForm.name=s),placeholder:e.$t("dept.name")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),r(i,{prop:"parentName",label:e.$t("dept.parentName"),class:"dept-list"},{default:a(()=>[r($,{width:400,ref:"deptListPopover",placement:"bottom-start",trigger:"click","popper-class":"popover-pop"},{reference:a(()=>[r(l,{modelValue:e.dataForm.parentName,"onUpdate:modelValue":t[2]||(t[2]=s=>e.dataForm.parentName=s),readonly:!0,placeholder:e.$t("dept.parentName")},{suffix:a(()=>[e.user.superAdmin===1&&e.dataForm.pid!=="0"?(p(),m(c,{key:0,onClick:t[1]||(t[1]=N(s=>e.deptListTreeSetDefaultHandle(),["stop"])),class:"el-input__icon"},{default:a(()=>[r(h)]),_:1})):H("v-if",!0)]),_:1},8,["modelValue","placeholder"])]),default:a(()=>[S("div",w,[r(g,{data:e.deptList,props:{label:"name",children:"children"},"node-key":"id",ref:"deptListTree","highlight-current":!0,"expand-on-click-node":!1,accordion:"",onCurrentChange:e.deptListTreeCurrentChangeHandle},null,8,["data","onCurrentChange"])])]),_:1},512)]),_:1},8,["label"]),r(i,{prop:"sort",label:e.$t("dept.sort")},{default:a(()=>[r(v,{modelValue:e.dataForm.sort,"onUpdate:modelValue":t[3]||(t[3]=s=>e.dataForm.sort=s),"controls-position":"right",min:0,label:e.$t("dept.sort")},null,8,["modelValue","label"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}var M=T(U,[["render",R],["__file","/Users/luochen/project17/taie-sword/taie-admin-vue/src/views/sys/dept-add-or-update.vue"]]);export{M as default};
