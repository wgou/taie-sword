import{d as q,a as F,r as a,t as T,u as E,F as r,E as i,H as o,G as s,B as k,z as L,a3 as H}from"./vlib.0bb5c6cc.js";/* empty css                   */import{Q as V}from"./quill.942ff23b.js";import{_ as S,u as w,a as C,g as U,b as p}from"./index.6b1e63f3.js";import"./monacoeditor.d62c48b5.js";import"./lodash.8cc0d8b0.js";import"./lib.aa75605a.js";const _=q({setup(){return F({visible:!1,quillEditor:null,quillEditorToolbarOptions:[["bold","italic","underline","strike"],["image"],[{list:"ordered"},{list:"bullet"}],[{size:["small",!1,"large","huge"]}],[{color:[]},{background:[]}],["clean"]],uploadUrl:"",deptList:[],dataForm:{id:0,noticeType:0,title:"",content:"",receiverType:0,receiverTypeIds:"",receiverTypeList:[],status:0,senderName:"",senderDate:"",creator:0,createDate:""}})},computed:{dataRule(){const e=(t,n,m)=>{if(this.quillEditor&&this.quillEditor.getLength()<=1)return m(new Error(this.$t("validate.required")));m()};return{noticeType:[{required:!0,message:this.$t("validate.required"),trigger:"blur"}],title:[{required:!0,message:this.$t("validate.required"),trigger:"blur"}],content:[{required:!0,message:this.$t("validate.required"),trigger:"blur"},{validator:e,trigger:"blur"}],receiverType:[{required:!0,message:this.$t("validate.required"),trigger:"blur"}],receiverTypeIds:[{required:!0,message:this.$t("validate.required"),trigger:"blur"}],status:[{required:!0,message:this.$t("validate.required"),trigger:"blur"}],senderName:[{required:!0,message:this.$t("validate.required"),trigger:"blur"}]}}},created(){this.dataFormSubmitHandle=w(this.dataFormSubmitHandle)},methods:{init(){this.visible=!0,this.$nextTick(()=>{this.quillEditor?this.quillEditor.deleteText(0,this.quillEditor.getLength()):this.quillEditorHandle(),this.$refs.dataFormRef.resetFields(),Promise.all([this.getDeptList()]).then(()=>{this.dataForm.id&&this.getInfo()})})},quillEditorHandle(){this.quillEditor=new V("#J_quillEditor",{modules:{toolbar:this.quillEditorToolbarOptions},theme:"snow"}),this.uploadUrl=`${C.api}/sys/oss/upload?token=${U()}`,this.quillEditor.getModule("toolbar").addHandler("image",()=>{this.$refs.uploadBtn.$el.click()}),this.quillEditor.on("text-change",()=>{this.quillEditor&&(this.dataForm.content=this.quillEditor.root.innerHTML)})},uploadBeforeUploadHandle(e){if(e.type!=="image/jpg"&&e.type!=="image/jpeg"&&e.type!=="image/png"&&e.type!=="image/gif")return this.$message.error(this.$t("upload.tip",{format:"jpg\u3001png\u3001gif"})),!1},uploadSuccessHandle(e){if(e.code!==0)return this.$message.error(e.msg);if(this.quillEditor){const t=this.quillEditor.getSelection();t&&this.quillEditor.insertEmbed(t.index,"image",e.data.src)}},getDeptList(){return p.get("/sys/dept/list").then(e=>{if(e.code!==0)return this.$message.error(e.msg);this.deptList=e.data})},getInfo(){p.get(`/sys/notice/${this.dataForm.id}`).then(e=>{if(e.code!==0)return this.$message.error(e.msg);this.dataForm={...this.dataForm,...e.data},this.quillEditor&&(this.quillEditor.root.innerHTML=this.dataForm.content),this.dataForm.receiverType===1&&this.$refs.deptListTree.setCheckedKeys(e.data.receiverTypeIds.split(","))})},dataFormSubmitHandle(e){this.$refs.dataFormRef.validate(t=>{if(!t)return!1;this.dataForm.receiverType===1?(this.dataForm.receiverTypeIds=this.$refs.deptListTree.getCheckedKeys().join(","),this.dataForm.receiverTypeList=this.$refs.deptListTree.getCheckedKeys()):this.dataForm.receiverTypeIds="",this.dataForm.status=e,(this.dataForm.id?p.put:p.post)("/sys/notice/",this.dataForm).then(n=>{if(n.code!==0)return this.$message.error(n.msg);this.$message({message:this.$t("prompt.success"),type:"success",duration:500,onClose:()=>{this.visible=!1,this.$emit("refreshDataList")}})})})}}});function D(e,t,n,m,B,I){const h=a("ren-radio-group"),d=a("el-form-item"),f=a("el-input"),u=a("el-button"),c=a("el-upload"),g=a("el-radio"),b=a("el-radio-group"),$=a("el-tree"),y=a("el-form"),v=a("el-dialog");return T(),E(v,{modelValue:e.visible,"onUpdate:modelValue":t[6]||(t[6]=l=>e.visible=l),title:e.dataForm.id?e.$t("update"):e.$t("add"),"close-on-click-modal":!1,"close-on-press-escape":!1},{footer:r(()=>[i(u,{onClick:t[3]||(t[3]=l=>e.visible=!1)},{default:r(()=>[o(s(e.$t("cancel")),1)]),_:1}),i(u,{type:"danger",onClick:t[4]||(t[4]=l=>e.dataFormSubmitHandle(0))},{default:r(()=>[o(s(e.$t("notice.draft")),1)]),_:1}),i(u,{type:"primary",onClick:t[5]||(t[5]=l=>e.dataFormSubmitHandle(1))},{default:r(()=>[o(s(e.$t("notice.release")),1)]),_:1})]),default:r(()=>[i(y,{model:e.dataForm,rules:e.dataRule,ref:"dataFormRef","label-width":e.$i18n.locale==="en-US"?"120px":"80px"},{default:r(()=>[i(d,{label:e.$t("notice.type"),prop:"noticeType"},{default:r(()=>[i(h,{modelValue:e.dataForm.noticeType,"onUpdate:modelValue":t[0]||(t[0]=l=>e.dataForm.noticeType=l),"dict-type":"notice_type"},null,8,["modelValue"])]),_:1},8,["label"]),i(d,{label:e.$t("notice.title"),prop:"title"},{default:r(()=>[i(f,{modelValue:e.dataForm.title,"onUpdate:modelValue":t[1]||(t[1]=l=>e.dataForm.title=l),placeholder:e.$t("notice.title")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),i(d,{prop:"content",label:e.$t("notice.content")},{default:r(()=>[t[7]||(t[7]=k("div",{id:"J_quillEditor",style:{height:"280px",width:"100%"}},null,-1)),i(c,{action:e.uploadUrl,"show-file-list":!1,"before-upload":e.uploadBeforeUploadHandle,"on-success":e.uploadSuccessHandle,style:{display:"none"}},{default:r(()=>[i(u,{ref:"uploadBtn",type:"primary",size:"small"},{default:r(()=>[o(s(e.$t("upload.button")),1)]),_:1},512)]),_:1},8,["action","before-upload","on-success"])]),_:1},8,["label"]),i(d,{label:e.$t("notice.receiverType"),prop:""},{default:r(()=>[i(b,{modelValue:e.dataForm.receiverType,"onUpdate:modelValue":t[2]||(t[2]=l=>e.dataForm.receiverType=l)},{default:r(()=>[i(g,{label:0},{default:r(()=>[o(s(e.$t("notice.receiverType0")),1)]),_:1}),i(g,{label:1},{default:r(()=>[o(s(e.$t("notice.receiverType1")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"]),L(i(d,{label:e.$t("notice.selectDept")},{default:r(()=>[i($,{data:e.deptList,props:{label:"name",children:"children"},"node-key":"id",ref:"deptListTree",accordion:"","show-checkbox":""},null,8,["data"])]),_:1},8,["label"]),[[H,e.dataForm.receiverType==1]])]),_:1},8,["model","rules","label-width"])]),_:1},8,["modelValue","title"])}var J=S(_,[["render",D]]);export{J as default};
