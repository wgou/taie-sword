import{d as b,a as g,r as o,t as L,u as F,F as a,E as s,H as p,G as f,O as k}from"./vlib.0bb5c6cc.js";import{_ as y,u as v,b as l}from"./index.c9acb6bc.js";import"./monacoeditor.d62c48b5.js";import"./lodash.8cc0d8b0.js";import"./lib.aa75605a.js";const C=b({setup(){return g({visible:!1,menuList:[],deptList:[],dataForm:{id:"",name:"",menuIdList:[],deptIdList:[],remark:""}})},computed:{dataRule(){return{name:[{required:!0,message:this.$t("validate.required"),trigger:"blur"}]}}},created(){this.dataFormSubmitHandle=v(this.dataFormSubmitHandle)},methods:{init(){this.visible=!0,this.$nextTick(()=>{this.$refs.dataFormRef.resetFields(),this.$refs.menuListTree.setCheckedKeys([]),this.$refs.deptListTree.setCheckedKeys([]),Promise.all([this.getMenuList(),this.getDeptList()]).then(()=>{this.dataForm.id&&this.getInfo()})})},getMenuList(){return l.get("/sys/menu/select").then(e=>{if(e.code!==0)return this.$message.error(e.msg);this.menuList=e.data})},getDeptList(){return l.get("/sys/dept/list").then(e=>{if(e.code!==0)return this.$message.error(e.msg);this.deptList=e.data})},getInfo(){l.get(`/sys/role/${this.dataForm.id}`).then(e=>{if(e.code!==0)return this.$message.error(e.msg);this.dataForm={...this.dataForm,...e.data},this.dataForm.menuIdList.forEach(t=>this.$refs.menuListTree.setChecked(t,!0)),this.$refs.deptListTree.setCheckedKeys(this.dataForm.deptIdList)})},dataFormSubmitHandle(){this.$refs.dataFormRef.validate(e=>{if(!e)return!1;this.dataForm.menuIdList=[...this.$refs.menuListTree.getHalfCheckedKeys(),...this.$refs.menuListTree.getCheckedKeys()],this.dataForm.deptIdList=this.$refs.deptListTree.getCheckedKeys(),(this.dataForm.id?l.put:l.post)("/sys/role",this.dataForm).then(t=>{if(t.code!==0)return this.$message.error(t.msg);this.$message({message:this.$t("prompt.success"),type:"success",duration:500,onClose:()=>{this.visible=!1,this.$emit("refreshDataList")}})})})}}});function T(e,t,V,_,I,K){const d=o("el-input"),i=o("el-form-item"),n=o("el-tree"),m=o("el-col"),h=o("el-row"),$=o("el-form"),u=o("el-button"),c=o("el-dialog");return L(),F(c,{modelValue:e.visible,"onUpdate:modelValue":t[5]||(t[5]=r=>e.visible=r),title:e.dataForm.id?e.$t("update"):e.$t("add"),"close-on-click-modal":!1,"close-on-press-escape":!1},{footer:a(()=>[s(u,{onClick:t[3]||(t[3]=r=>e.visible=!1)},{default:a(()=>[p(f(e.$t("cancel")),1)]),_:1}),s(u,{type:"primary",onClick:t[4]||(t[4]=r=>e.dataFormSubmitHandle())},{default:a(()=>[p(f(e.$t("confirm")),1)]),_:1})]),default:a(()=>[s($,{model:e.dataForm,rules:e.dataRule,ref:"dataFormRef",onKeyup:t[2]||(t[2]=k(r=>e.dataFormSubmitHandle(),["enter"])),"label-width":"120px"},{default:a(()=>[s(i,{prop:"name",label:e.$t("role.name")},{default:a(()=>[s(d,{modelValue:e.dataForm.name,"onUpdate:modelValue":t[0]||(t[0]=r=>e.dataForm.name=r),placeholder:e.$t("role.name")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),s(i,{prop:"remark",label:e.$t("role.remark")},{default:a(()=>[s(d,{modelValue:e.dataForm.remark,"onUpdate:modelValue":t[1]||(t[1]=r=>e.dataForm.remark=r),placeholder:e.$t("role.remark")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),s(h,null,{default:a(()=>[s(m,{span:12},{default:a(()=>[s(i,{size:"small",label:e.$t("role.menuList")},{default:a(()=>[s(n,{data:e.menuList,props:{label:"name",children:"children"},"node-key":"id",ref:"menuListTree",accordion:"","show-checkbox":""},null,8,["data"])]),_:1},8,["label"])]),_:1}),s(m,{span:12},{default:a(()=>[s(i,{size:"small",label:e.$t("role.deptList")},{default:a(()=>[s(n,{data:e.deptList,props:{label:"name",children:"children"},"node-key":"id",ref:"deptListTree",accordion:"","show-checkbox":""},null,8,["data"])]),_:1},8,["label"])]),_:1})]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}var U=y(C,[["render",T]]);export{U as default};
