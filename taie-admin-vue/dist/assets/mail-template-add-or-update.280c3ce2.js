import{d as $,a as F,r as o,t as q,u as E,G as l,F as i,I as u,H as n,f,B as v,P as y}from"./vlib.73c86f1d.js";import{_ as H,j as w,c as V,g as j,b as m}from"./index.bc4fd47c.js";/* empty css                   */import{Q as k}from"./quill.942ff23b.js";import"./monacoeditor.d62c48b5.js";import"./lodash.58534d7e.js";import"./lib.e5e0e84e.js";const B=$({setup(){return F({visible:!1,quillEditor:null,quillEditorToolbarOptions:[["bold","italic","underline","strike"],["blockquote","code-block","image"],[{header:1},{header:2}],[{list:"ordered"},{list:"bullet"}],[{script:"sub"},{script:"super"}],[{indent:"-1"},{indent:"+1"}],[{direction:"rtl"}],[{size:["small",!1,"large","huge"]}],[{header:[1,2,3,4,5,6,!1]}],[{color:[]},{background:[]}],[{font:[]}],[{align:[]}],["clean"]],uploadUrl:"",dataForm:{id:"",name:"",subject:"",content:""}})},computed:{dataRule(){const e=(t,h,r)=>{if(this.quillEditor&&this.quillEditor.getLength()<=1)return r(new Error(this.$t("validate.required")));r()};return{name:[{required:!0,message:this.$t("validate.required"),trigger:"blur"}],subject:[{required:!0,message:this.$t("validate.required"),trigger:"blur"}],content:[{required:!0,message:this.$t("validate.required"),trigger:"blur"},{validator:e,trigger:"blur"}]}}},created(){this.dataFormSubmitHandle=w(this.dataFormSubmitHandle)},methods:{init(){this.visible=!0,this.$nextTick(()=>{this.quillEditor?this.quillEditor.deleteText(0,this.quillEditor.getLength()):this.quillEditorHandle(),this.$refs.dataFormRef.resetFields(),this.dataForm.id&&this.getInfo()})},quillEditorHandle(){this.quillEditor=new k("#J_quillEditor",{modules:{toolbar:this.quillEditorToolbarOptions},theme:"snow"}),this.uploadUrl=`${V.api}/sys/oss/upload?token=${j()}`,this.quillEditor.getModule("toolbar").addHandler("image",()=>{this.$refs.uploadBtn.$el.click()}),this.quillEditor.on("text-change",()=>{this.quillEditor&&(this.dataForm.content=this.quillEditor.root.innerHTML)})},uploadBeforeUploadHandle(e){if(e.type!=="image/jpg"&&e.type!=="image/jpeg"&&e.type!=="image/png"&&e.type!=="image/gif")return this.$message.error(this.$t("upload.tip",{format:"jpg\u3001png\u3001gif"})),!1},uploadSuccessHandle(e){if(e.code!==0)return this.$message.error(e.msg);if(this.quillEditor){const t=this.quillEditor.getSelection();t&&this.quillEditor.insertEmbed(t.index,"image",e.data.src)}},getInfo(){m.get(`/sys/mailtemplate/${this.dataForm.id}`).then(e=>{if(e.code!==0)return this.$message.error(e.msg);this.quillEditor&&(this.dataForm=e.data,this.quillEditor.root.innerHTML=this.dataForm.content)})},dataFormSubmitHandle(){this.$refs.dataFormRef.validate(e=>{if(!e)return!1;(this.dataForm.id?m.put:m.post)("/sys/mailtemplate",this.dataForm,{"content-type":"application/x-www-form-urlencoded"}).then(t=>{if(t.code!==0)return this.$message.error(t.msg);this.$message({message:this.$t("prompt.success"),type:"success",duration:500,onClose:()=>{this.visible=!1,this.$emit("refreshDataList")}})})})}}});function C(e,t,h,r,S,U){const p=o("el-input"),s=o("el-form-item"),d=o("el-button"),g=o("el-upload"),b=o("el-form"),c=o("el-dialog");return q(),E(c,{modelValue:e.visible,"onUpdate:modelValue":t[5]||(t[5]=a=>e.visible=a),title:e.dataForm.id?e.$t("update"):e.$t("add"),"close-on-click-modal":!1,"close-on-press-escape":!1},{footer:l(()=>[i(d,{onClick:t[3]||(t[3]=a=>e.visible=!1)},{default:l(()=>[u(n(e.$t("cancel")),1)]),_:1}),i(d,{type:"primary",onClick:t[4]||(t[4]=a=>e.dataFormSubmitHandle())},{default:l(()=>[u(n(e.$t("confirm")),1)]),_:1})]),default:l(()=>[i(b,{model:e.dataForm,rules:e.dataRule,ref:"dataFormRef",onKeyup:t[2]||(t[2]=y(a=>e.dataFormSubmitHandle(),["enter"])),"label-width":"120px"},{default:l(()=>[i(s,{prop:"name",label:e.$t("mail.name")},{default:l(()=>[i(p,{modelValue:e.dataForm.name,"onUpdate:modelValue":t[0]||(t[0]=a=>e.dataForm.name=a),placeholder:e.$t("mail.name")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),i(s,{prop:"subject",label:e.$t("mail.subject")},{default:l(()=>[i(p,{modelValue:e.dataForm.subject,"onUpdate:modelValue":t[1]||(t[1]=a=>e.dataForm.subject=a),placeholder:e.$t("mail.subject")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),i(s,{prop:"content",label:e.$t("mail.content")},{default:l(()=>[f(" \u5BCC\u6587\u672C\u7F16\u8F91\u5668, \u5BB9\u5668 "),t[6]||(t[6]=v("div",{id:"J_quillEditor",style:{height:"200px",width:"100%"}},null,-1)),f(" \u81EA\u5B9A\u4E49\u4E0A\u4F20\u56FE\u7247\u529F\u80FD (\u4F7F\u7528element upload\u7EC4\u4EF6) "),i(g,{action:e.uploadUrl,"show-file-list":!1,"before-upload":e.uploadBeforeUploadHandle,"on-success":e.uploadSuccessHandle,style:{display:"none"}},{default:l(()=>[i(d,{ref:"uploadBtn",type:"primary",size:"small"},{default:l(()=>[u(n(e.$t("upload.button")),1)]),_:1},512)]),_:1},8,["action","before-upload","on-success"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}var M=H(B,[["render",C],["__file","/Users/luochen/project17/taie-sword/taie-admin-vue/src/views/message/mail-template-add-or-update.vue"]]);export{M as default};
