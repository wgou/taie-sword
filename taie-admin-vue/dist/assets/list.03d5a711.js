import{u as N}from"./useView.b2a319db.js";import{d as A,a as z,e as x,a0 as T,w as H,S as R,r,y as K,t as g,A as w,F as a,G as n,I as b,H as l,P as M,z as P,u as I,f as L,B as d}from"./vlib.73c86f1d.js";import{_ as U,l as j,m as q}from"./index.bc4fd47c.js";import"./monacoeditor.d62c48b5.js";import"./lodash.58534d7e.js";import"./lib.e5e0e84e.js";const G=A({components:{ArrowLeft:j,ArrowRight:q},props:{deviceId:{type:String,default:""}},setup(e){const t=z({post:!0,getDataListURL:"/screenSnapshot/page",getDataListIsPage:!0,dataForm:{deviceId:e.deviceId||"",pkg:"",description:""}}),o=x(!1),m=x(0),f=x(!1),v=N(t),u=T(t);let s=null;return H(()=>t.dataListLoading,c=>{c&&o.value?s=R.service({lock:!0,text:"\u52A0\u8F7D\u4E2D...",background:"rgba(255, 255, 255, 0.7)"}):s&&(s.close(),s=null)}),{...v,...u,previewVisible:o,currentPreviewIndex:m,isLoadingNextPage:f}},mounted(){this.deviceId&&(this.dataForm.deviceId=this.deviceId,this.getDataList())},computed:{imageList(){return this.dataList.filter(e=>e.base64).map(e=>`data:image/png;base64,${e.base64}`)},validImageData(){return this.dataList.filter(e=>e.base64)},validImageCount(){return this.validImageData.length},currentImageData(){return this.isLoadingNextPage?null:this.validImageData[this.currentPreviewIndex]||null},isLastImage(){return this.currentPreviewIndex===this.validImageCount-1},isLastPage(){const e=Math.ceil(this.total/this.limit);return this.page>=e},globalImageIndex(){return(this.page-1)*this.limit+this.currentPreviewIndex+1}},methods:{formatDateTime(e){if(!e)return"";const t=new Date(e);if(isNaN(t.getTime()))return"";const o=t.getFullYear(),m=String(t.getMonth()+1).padStart(2,"0"),f=String(t.getDate()).padStart(2,"0"),v=String(t.getHours()).padStart(2,"0"),u=String(t.getMinutes()).padStart(2,"0"),s=String(t.getSeconds()).padStart(2,"0");return`${o}-${m}-${f} ${v}:${u}:${s}`},getImageIndex(e){let t=0;for(let o=0;o<=e;o++)if(this.dataList[o]&&this.dataList[o].base64){if(o===e)return t;t++}return 0},openPreview(e){this.currentPreviewIndex=this.getImageIndex(e),this.previewVisible=!0,Math.ceil(this.total/this.limit)},closePreview(){this.previewVisible=!1,this.currentPreviewIndex=0},async prevImage(){if(Math.ceil(this.total/this.limit),this.currentPreviewIndex>0)this.currentPreviewIndex--;else if(this.page>1&&!this.isLoadingNextPage){this.isLoadingNextPage=!0;const e=this.page-1;try{await this.pageCurrentChangeHandle(e),await this.$nextTick(),await this.$nextTick(),this.dataList&&this.dataList.length>0&&this.validImageCount>0&&(this.currentPreviewIndex=this.validImageCount-1,await this.$nextTick())}catch(t){console.error("\u7FFB\u9875\u9519\u8BEF:",t)}finally{this.isLoadingNextPage=!1}}},async nextImage(){const e=Math.ceil(this.total/this.limit);if(this.currentPreviewIndex<this.validImageCount-1)this.currentPreviewIndex++;else if(this.page<e&&!this.isLoadingNextPage){this.isLoadingNextPage=!0;const t=this.page+1;try{await this.pageCurrentChangeHandle(t),await this.$nextTick(),await this.$nextTick(),this.dataList&&this.dataList.length>0&&(this.currentPreviewIndex=0,await this.$nextTick())}catch(o){console.error("\u7FFB\u9875\u9519\u8BEF:",o)}finally{this.isLoadingNextPage=!1}}},handleKeydown(e){e.key==="ArrowLeft"?(e.preventDefault(),this.prevImage()):e.key==="ArrowRight"?(e.preventDefault(),this.nextImage()):e.key==="Escape"&&this.closePreview()}}}),Y={class:"mod-snapshot__list"},J={key:1},O={class:"preview-header"},Q={class:"preview-info"},W={style:{"margin-left":"20px"}},X={class:"preview-image-container","element-loading-text":"\u6B63\u5728\u52A0\u8F7D\u56FE\u7247...","element-loading-background":"rgba(250, 250, 250, 0.9)"},Z={key:0,class:"preview-description"},ee={class:"preview-controls"},te={class:"preview-counter"};function ae(e,t,o,m,f,v){const u=r("el-input"),s=r("el-form-item"),c=r("el-button"),D=r("el-form"),h=r("el-table-column"),k=r("el-image"),F=r("el-table"),$=r("el-pagination"),E=r("ArrowLeft"),y=r("el-icon"),S=r("ArrowRight"),V=r("el-dialog"),C=K("loading");return g(),w("div",Y,[a(D,{inline:!0,model:e.dataForm,onKeyup:t[4]||(t[4]=M(i=>e.getDataList(),["enter"]))},{default:n(()=>[a(s,null,{default:n(()=>[a(u,{modelValue:e.dataForm.deviceId,"onUpdate:modelValue":t[0]||(t[0]=i=>e.dataForm.deviceId=i),placeholder:"\u8BBE\u5907ID",clearable:""},null,8,["modelValue"])]),_:1}),a(s,null,{default:n(()=>[a(u,{modelValue:e.dataForm.pkg,"onUpdate:modelValue":t[1]||(t[1]=i=>e.dataForm.pkg=i),placeholder:"\u5305\u540D",clearable:""},null,8,["modelValue"])]),_:1}),a(s,null,{default:n(()=>[a(u,{modelValue:e.dataForm.description,"onUpdate:modelValue":t[2]||(t[2]=i=>e.dataForm.description=i),placeholder:"\u63CF\u8FF0",clearable:""},null,8,["modelValue"])]),_:1}),a(s,null,{default:n(()=>[a(c,{onClick:t[3]||(t[3]=i=>e.getDataList())},{default:n(()=>[b(l(e.$t("query")),1)]),_:1})]),_:1})]),_:1},8,["model"]),P((g(),I(F,{data:e.dataList,border:"",onSortChange:e.dataListSortChangeHandle,"table-layout":"auto",style:{width:"100%"}},{default:n(()=>[a(h,{prop:"deviceId",label:"\u8BBE\u5907ID","header-align":"center",align:"center",width:"200px","show-overflow-tooltip":""}),a(h,{prop:"pkg",label:"\u5305\u540D","header-align":"center",align:"center",width:"150px","show-overflow-tooltip":""}),a(h,{prop:"description",label:"\u63CF\u8FF0","header-align":"center",align:"center","show-overflow-tooltip":""}),a(h,{label:"\u622A\u56FE\u9884\u89C8","header-align":"center",align:"center",width:"150px"},{default:n(i=>[i.row.base64?(g(),I(k,{key:0,src:`data:image/png;base64,${i.row.base64}`,fit:"cover",style:{width:"100px",height:"150px",cursor:"pointer"},onClick:p=>e.openPreview(i.$index),"preview-teleported":!1},null,8,["src","onClick"])):(g(),w("span",J,"\u65E0\u622A\u56FE"))]),_:1}),a(h,{prop:"time",label:"\u622A\u56FE\u65F6\u95F4","header-align":"center",align:"center",width:"180px",sortable:"custom"},{default:n(i=>[b(l(e.formatDateTime(i.row.time)),1)]),_:1})]),_:1},8,["data","onSortChange"])),[[C,e.dataListLoading]]),a($,{"current-page":e.page,"page-sizes":[10,20,50,100],"page-size":e.limit,total:e.total,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:e.pageSizeChangeHandle,onCurrentChange:e.pageCurrentChangeHandle},null,8,["current-page","page-size","total","onSizeChange","onCurrentChange"]),L(" \u81EA\u5B9A\u4E49\u56FE\u7247\u9884\u89C8\u5BF9\u8BDD\u6846 "),a(V,{modelValue:e.previewVisible,"onUpdate:modelValue":t[6]||(t[6]=i=>e.previewVisible=i),fullscreen:"","close-on-click-modal":!0,"destroy-on-close":"",class:"preview-dialog",onClose:e.closePreview},{header:n(()=>{var i,p;return[d("div",O,[t[7]||(t[7]=d("h3",null,"\u622A\u56FE\u9884\u89C8",-1)),d("div",Q,[d("span",null,"\u8BBE\u5907ID: "+l(((i=e.currentImageData)==null?void 0:i.deviceId)||"-"),1),d("span",W,"\u5305\u540D: "+l(((p=e.currentImageData)==null?void 0:p.pkg)||"-"),1)])])]}),default:n(()=>{var i,p,_;return[d("div",{class:"preview-content",onKeydown:t[5]||(t[5]=(...B)=>e.handleKeydown&&e.handleKeydown(...B)),tabindex:"0"},[P((g(),w("div",X,[((i=e.currentImageData)==null?void 0:i.base64)&&!e.isLoadingNextPage?(g(),I(k,{key:0,src:`data:image/png;base64,${e.currentImageData.base64}`,fit:"contain",class:"preview-image"},null,8,["src"])):L("v-if",!0)])),[[C,e.isLoadingNextPage]]),((p=e.currentImageData)==null?void 0:p.description)&&!e.isLoadingNextPage?(g(),w("div",Z,l(e.formatDateTime((_=e.currentImageData)==null?void 0:_.time))+" | "+l(e.currentImageData.description),1)):L("v-if",!0),d("div",ee,[a(c,{disabled:e.currentPreviewIndex===0&&e.page===1||e.isLoadingNextPage,onClick:e.prevImage},{default:n(()=>[a(y,null,{default:n(()=>[a(E)]),_:1}),t[8]||(t[8]=b(" \u4E0A\u4E00\u5F20 "))]),_:1},8,["disabled","onClick"]),d("span",te,l(e.globalImageIndex)+" / "+l(e.total),1),a(c,{disabled:e.isLastImage&&e.isLastPage||e.isLoadingNextPage,onClick:e.nextImage},{default:n(()=>[t[9]||(t[9]=b(" \u4E0B\u4E00\u5F20 ")),a(y,null,{default:n(()=>[a(S)]),_:1})]),_:1},8,["disabled","onClick"])])],32)]}),_:1},8,["modelValue","onClose"])])}var de=U(G,[["render",ae],["__scopeId","data-v-c6dffc42"],["__file","/Users/luochen/project17/taie-sword/taie-admin-vue/src/views/snapshot/list.vue"]]);export{de as default};
