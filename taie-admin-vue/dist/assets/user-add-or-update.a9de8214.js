import{d as P,a as q,r as d,t as b,u as h,F as o,E as l,H as n,G as p,L as V,A as E,I as S,J as C,O as D}from"./vlib.982cfaee.js";import{_ as R,j as H,b as f,l as k,m as A}from"./index.08ae0f5b.js";import"./monacoeditor.d62c48b5.js";import"./lodash.0b661716.js";import"./lib.b62e57c8.js";const B=P({setup(){return q({dataForm:{id:"",username:"",deptId:"",deptName:"",password:"",confirmPassword:"",realName:"",gender:0,email:"",mobile:"",roleIdList:[],status:1},visible:!1,roleList:[],roleIdListDefault:[]})},computed:{dataRule(){const e=(u,s,r)=>{if(!this.dataForm.id&&!/\S/.test(s))return r(new Error(this.$t("validate.required")));r()},a=(u,s,r)=>{if(!this.dataForm.id&&!/\S/.test(s))return r(new Error(this.$t("validate.required")));if(this.dataForm.password!==s)return r(new Error(this.$t("user.validate.confirmPassword")));r()},m=(u,s,r)=>{if(s&&!k(s))return r(new Error(this.$t("validate.format",{attr:this.$t("user.email")})));r()},$=(u,s,r)=>{if(s&&!A(s))return r(new Error(this.$t("validate.format",{attr:this.$t("user.mobile")})));r()};return{username:[{required:!0,message:this.$t("validate.required"),trigger:"blur"}],deptName:[{required:!0,message:this.$t("validate.required"),trigger:"change"}],password:[{validator:e,trigger:"blur"}],confirmPassword:[{validator:a,trigger:"blur"}],realName:[{required:!0,message:this.$t("validate.required"),trigger:"blur"}],email:[{validator:m,trigger:"blur"}],mobile:[{validator:$,trigger:"blur"}]}}},created(){this.dataFormSubmitHandle=H(this.dataFormSubmitHandle)},methods:{init(){this.visible=!0,this.dataForm.deptId="",this.$nextTick(()=>{this.$refs.dataFormRef.resetFields(),this.roleIdListDefault=[],Promise.all([this.getRoleList()]).then(()=>{this.dataForm.id&&this.getInfo()})})},getRoleList(){return f.get("/sys/role/list").then(e=>{if(e.code!==0)return this.$message.error(e.msg);this.roleList=e.data})},getInfo(){f.get(`/sys/user/${this.dataForm.id}`).then(e=>{if(e.code!==0)return this.$message.error(e.msg);this.dataForm={...this.dataForm,...e.data,roleIdList:[]};for(let a=0;a<e.data.roleIdList.length;a++){if(this.roleList.filter(m=>m.id===e.data.roleIdList[a])[0]){this.dataForm.roleIdList.push(e.data.roleIdList[a]);continue}this.roleIdListDefault.push(e.data.roleIdList[a])}})},dataFormSubmitHandle(){this.$refs.dataFormRef.validate(e=>{if(!e)return!1;(this.dataForm.id?f.put:f.post)("/sys/user",{...this.dataForm,roleIdList:[...this.dataForm.roleIdList,...this.roleIdListDefault]}).then(a=>{if(a.code!==0)return this.$message.error(a.msg);this.$message({message:this.$t("prompt.success"),type:"success",duration:500,onClose:()=>{this.visible=!1,this.$emit("refreshDataList")}})})})}}});function O(e,a,m,$,u,s){const r=d("el-input"),i=d("el-form-item"),v=d("ren-dept-tree"),w=d("ren-radio-group"),L=d("el-option"),I=d("el-select"),F=d("el-radio"),N=d("el-radio-group"),y=d("el-form"),g=d("el-button"),U=d("el-dialog");return b(),h(U,{modelValue:e.visible,"onUpdate:modelValue":a[14]||(a[14]=t=>e.visible=t),title:e.dataForm.id?e.$t("update"):e.$t("add"),"close-on-click-modal":!1,"close-on-press-escape":!1},{footer:o(()=>[l(g,{onClick:a[12]||(a[12]=t=>e.visible=!1)},{default:o(()=>[n(p(e.$t("cancel")),1)]),_:1}),l(g,{type:"primary",onClick:a[13]||(a[13]=t=>e.dataFormSubmitHandle())},{default:o(()=>[n(p(e.$t("confirm")),1)]),_:1})]),default:o(()=>[l(y,{model:e.dataForm,rules:e.dataRule,ref:"dataFormRef",onKeyup:a[11]||(a[11]=D(t=>e.dataFormSubmitHandle(),["enter"])),"label-width":"120px"},{default:o(()=>[l(i,{prop:"username",label:e.$t("user.username")},{default:o(()=>[l(r,{modelValue:e.dataForm.username,"onUpdate:modelValue":a[0]||(a[0]=t=>e.dataForm.username=t),placeholder:e.$t("user.username")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(i,{prop:"deptName",label:e.$t("user.deptName")},{default:o(()=>[l(v,{modelValue:e.dataForm.deptId,"onUpdate:modelValue":a[1]||(a[1]=t=>e.dataForm.deptId=t),placeholder:e.$t("dept.title"),deptName:e.dataForm.deptName,"onUpdate:deptName":a[2]||(a[2]=t=>e.dataForm.deptName=t)},null,8,["modelValue","placeholder","deptName"])]),_:1},8,["label"]),l(i,{prop:"password",label:e.$t("user.password"),class:V({"is-required":!e.dataForm.id})},{default:o(()=>[l(r,{modelValue:e.dataForm.password,"onUpdate:modelValue":a[3]||(a[3]=t=>e.dataForm.password=t),type:"password",placeholder:e.$t("user.password")},null,8,["modelValue","placeholder"])]),_:1},8,["label","class"]),l(i,{prop:"confirmPassword",label:e.$t("user.confirmPassword"),class:V({"is-required":!e.dataForm.id})},{default:o(()=>[l(r,{modelValue:e.dataForm.confirmPassword,"onUpdate:modelValue":a[4]||(a[4]=t=>e.dataForm.confirmPassword=t),type:"password",placeholder:e.$t("user.confirmPassword")},null,8,["modelValue","placeholder"])]),_:1},8,["label","class"]),l(i,{prop:"realName",label:e.$t("user.realName")},{default:o(()=>[l(r,{modelValue:e.dataForm.realName,"onUpdate:modelValue":a[5]||(a[5]=t=>e.dataForm.realName=t),placeholder:e.$t("user.realName")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(i,{prop:"gender",label:e.$t("user.gender")},{default:o(()=>[l(w,{modelValue:e.dataForm.gender,"onUpdate:modelValue":a[6]||(a[6]=t=>e.dataForm.gender=t),"dict-type":"gender"},null,8,["modelValue"])]),_:1},8,["label"]),l(i,{prop:"email",label:e.$t("user.email")},{default:o(()=>[l(r,{modelValue:e.dataForm.email,"onUpdate:modelValue":a[7]||(a[7]=t=>e.dataForm.email=t),placeholder:e.$t("user.email")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(i,{prop:"mobile",label:e.$t("user.mobile")},{default:o(()=>[l(r,{modelValue:e.dataForm.mobile,"onUpdate:modelValue":a[8]||(a[8]=t=>e.dataForm.mobile=t),placeholder:e.$t("user.mobile")},null,8,["modelValue","placeholder"])]),_:1},8,["label"]),l(i,{prop:"roleIdList",label:e.$t("user.roleIdList"),class:"role-list"},{default:o(()=>[l(I,{modelValue:e.dataForm.roleIdList,"onUpdate:modelValue":a[9]||(a[9]=t=>e.dataForm.roleIdList=t),multiple:"",placeholder:e.$t("user.roleIdList")},{default:o(()=>[(b(!0),E(C,null,S(e.roleList,t=>(b(),h(L,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","placeholder"])]),_:1},8,["label"]),l(i,{prop:"status",label:e.$t("user.status"),size:"small"},{default:o(()=>[l(N,{modelValue:e.dataForm.status,"onUpdate:modelValue":a[10]||(a[10]=t=>e.dataForm.status=t)},{default:o(()=>[l(F,{label:0},{default:o(()=>[n(p(e.$t("user.status0")),1)]),_:1}),l(F,{label:1},{default:o(()=>[n(p(e.$t("user.status1")),1)]),_:1})]),_:1},8,["modelValue"])]),_:1},8,["label"])]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"])}var G=R(B,[["render",O],["__scopeId","data-v-4f500a43"]]);export{G as default};
